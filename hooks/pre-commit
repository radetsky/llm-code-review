#!/bin/bash
# Pre-commit hook for LLM code review
# This hook runs before any commit is made

set -e  # Exit on any error

echo "üîç Running LLM code review..."

# Check if review.py exists
if [ ! -f "review.py" ]; then
    echo "‚ö†Ô∏è  review.py not found. Skipping code review."
    exit 0
fi

# Run review on staged changes
python review.py --mode staged --format text 2>/dev/null
exit_code=$?

# Handle different exit codes
case $exit_code in
    0)
        echo "‚úÖ Code review passed"
        exit 0
        ;;
    1)
        echo ""
        echo "‚ùå COMMIT BLOCKED: Critical issues found!"
        echo "   Please fix the critical issues before committing."
        exit 1
        ;;
    2)
        echo ""
        echo "‚ö†Ô∏è  Warnings found, but commit allowed."
        echo "   Consider addressing the warnings for better code quality."
        exit 0
        ;;
    3)
        echo ""
        echo "‚ö†Ô∏è  LLM model unavailable, but commit allowed."
        echo "   Code review was performed using static analysis only."
        exit 0
        ;;
    4)
        echo ""
        echo "‚ùå Configuration error. Please check your setup."
        echo "   Run 'python review.py --test-connection' to diagnose."
        exit 1
        ;;
    *)
        echo ""
        echo "‚ùå Unexpected error occurred during code review."
        echo "   Exit code: $exit_code"
        exit 1
        ;;
esac